<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sistema de Chamados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .priority-low { border-left: 4px solid #10b981; }
        .priority-medium { border-left: 4px solid #f59e0b; }
        .priority-high { border-left: 4px solid #ef4444; }
        .priority-critical { border-left: 4px solid #7c3aed; }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-orange-600 text-white shadow-lg">
            <div class="container mx-auto px-4 py-6 flex justify-between items-center">
                <h1 class="text-2xl font-bold">Sistema de Chamados</h1>
                <button id="notificationBtn" class="text-blue-100 hover:text-white relative">
                    <i class="fas fa-bell text-xl"></i>
                    <span id="notificationBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">Todos os Chamados</h2>
                <button id="openTicketModal" class="bg-orange-600 hover:bg-gray-600 text-white px-6 py-2 rounded-lg flex items-center space-x-2">
                    <i class="fas fa-plus"></i><span>Abrir Chamado</span>
                </button>
            </div>

            <!-- Filtros -->
            <div class="flex flex-wrap gap-3 mb-4">
                <input type="text" placeholder="Buscar..." id="searchInput" class="w-full md:w-64 border p-2 rounded">
                <select id="statusFilter" class="border p-2 rounded">
                    <option value="">Todos os status</option>
                    <option value="open">Aberto</option>
                    <option value="in-progress">Em andamento</option>
                    <option value="resolved">Resolvido</option>
                </select>
                <select id="priorityFilter" class="border p-2 rounded">
                    <option value="">Todas as prioridades</option>
                    <option value="low">Baixa</option>
                    <option value="medium">Média</option>
                    <option value="high">Alta</option>
                    <option value="critical">Crítica</option>
                </select>
            </div>

            <!-- Tabela -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3">ID</th>
                            <th class="px-6 py-3">Assunto</th>
                            <th class="px-6 py-3">Cliente</th>
                            <th class="px-6 py-3">Prioridade</th>
                            <th class="px-6 py-3">Status</th>
                            <th class="px-6 py-3">Data</th>
                            <th class="px-6 py-3">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="ticketsList" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div id="ticketModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl relative">
            <button id="closeTicketModal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
            <h3 class="text-lg font-medium mb-4" id="modalTitle">Abrir Novo Chamado</h3>
            <form id="ticketForm" class="space-y-4">
                <input type="text" id="subject" placeholder="Assunto" required class="w-full border p-2 rounded">
                <select id="client" required class="w-full border p-2 rounded">
                    <option value="">Selecione um cliente</option>
                    <option>Rossetti Filhos</option>
                    <option>Rossetti Locações</option>
                    <option>AMD</option>
                    <option>BBA</option>
                    <option>Faturamento</option>
                </select>
                <select id="priority" required class="w-full border p-2 rounded">
                    <option value="">Selecione a prioridade</option>
                    <option value="low">Baixa</option>
                    <option value="medium">Média</option>
                    <option value="high">Alta</option>
                    <option value="critical">Crítica</option>
                </select>
                <textarea id="description" rows="4" placeholder="Descrição" required class="w-full border p-2 rounded"></textarea>
                <div class="flex justify-end gap-2">
                    <button type="button" id="cancelTicketBtn" class="bg-gray-300 px-4 py-2 rounded">Cancelar</button>
                    <button type="submit" id="saveTicketBtn" class="bg-orange-600 text-white px-4 py-2 rounded">Abrir Chamado</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function loadTickets() {
            return JSON.parse(localStorage.getItem("tickets")) || [];
        }
        function saveTickets() {
            localStorage.setItem("tickets", JSON.stringify(tickets));
        }

        let tickets = loadTickets();
        const ticketsList = document.getElementById("ticketsList");
        const searchInput = document.getElementById("searchInput");
        const statusFilter = document.getElementById("statusFilter");
        const priorityFilter = document.getElementById("priorityFilter");
        const ticketModal = document.getElementById("ticketModal");
        const openTicketModalBtn = document.getElementById("openTicketModal");
        const closeTicketModalBtn = document.getElementById("closeTicketModal");
        const cancelTicketBtn = document.getElementById("cancelTicketBtn");
        const ticketForm = document.getElementById("ticketForm");
        const saveTicketBtn = document.getElementById("saveTicketBtn");
        const modalTitle = document.getElementById("modalTitle");
        let editingTicketId = null;

        function displayTickets() {
            const searchTerm = searchInput.value.toLowerCase();
            const statusTerm = statusFilter.value;
            const priorityTerm = priorityFilter.value;
            ticketsList.innerHTML = "";

            const filtered = tickets.filter(ticket => {
                const matchSearch = ticket.subject.toLowerCase().includes(searchTerm) ||
                                    ticket.client.toLowerCase().includes(searchTerm) ||
                                    ticket.description.toLowerCase().includes(searchTerm);
                const matchStatus = statusTerm ? ticket.status === statusTerm : true;
                const matchPriority = priorityTerm ? ticket.priority === priorityTerm : true;
                return matchSearch && matchStatus && matchPriority;
            });

            if (!filtered.length) {
                ticketsList.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-gray-500">Nenhum chamado encontrado.</td></tr>`;
                return;
            }

            filtered.forEach(ticket => {
                const tr = document.createElement("tr");
                tr.classList.add(`priority-${ticket.priority}`);
                tr.innerHTML = `
                    <td class="px-6 py-4">${ticket.id}</td>
                    <td class="px-6 py-4">${ticket.subject}</td>
                    <td class="px-6 py-4">${ticket.client}</td>
                    <td class="px-6 py-4 capitalize">${ticket.priority}</td>
                    <td class="px-6 py-4 capitalize">${ticket.status.replace("-", " ")}</td>
                    <td class="px-6 py-4">${ticket.date}</td>
                    <td class="px-6 py-4 space-x-2">
                        ${ticket.status !== "resolved" ? `<button class="closeBtn text-green-600"><i class="fas fa-check"></i> Encerrar</button>` : ""}
                        <button class="editBtn text-yellow-500"><i class="fas fa-pen"></i></button>
                        <button class="deleteBtn text-red-600"><i class="fas fa-trash"></i></button>
                    </td>
                `;

                if (ticket.status !== "resolved") {
                    tr.querySelector(".closeBtn").addEventListener("click", () => {
                        ticket.status = "resolved";
                        saveTickets();
                        displayTickets();
                        alert(`Chamado ID ${ticket.id} encerrado.`);
                    });
                }

                tr.querySelector(".editBtn").addEventListener("click", () => {
                    editingTicketId = ticket.id;
                    modalTitle.textContent = "Editar Chamado";
                    saveTicketBtn.textContent = "Salvar Alterações";
                    ticketForm.subject.value = ticket.subject;
                    ticketForm.client.value = ticket.client;
                    ticketForm.priority.value = ticket.priority;
                    ticketForm.description.value = ticket.description;
                    ticketModal.classList.remove("hidden");
                });

                tr.querySelector(".deleteBtn").addEventListener("click", () => {
                    if (confirm(`Excluir chamado ID ${ticket.id}?`)) {
                        tickets = tickets.filter(t => t.id !== ticket.id);
                        saveTickets();
                        displayTickets();
                    }
                });

                ticketsList.appendChild(tr);
            });
        }

        openTicketModalBtn.addEventListener("click", () => {
            editingTicketId = null;
            modalTitle.textContent = "Abrir Novo Chamado";
            saveTicketBtn.textContent = "Abrir Chamado";
            ticketForm.reset();
            ticketModal.classList.remove("hidden");
        });
        closeTicketModalBtn.addEventListener("click", () => ticketModal.classList.add("hidden"));
        cancelTicketBtn.addEventListener("click", () => ticketModal.classList.add("hidden"));

        ticketForm.addEventListener("submit", e => {
            e.preventDefault();
            if (editingTicketId) {
                const t = tickets.find(t => t.id === editingTicketId);
                if (t) {
                    t.subject = ticketForm.subject.value;
                    t.client = ticketForm.client.value;
                    t.priority = ticketForm.priority.value;
                    t.description = ticketForm.description.value;
                }
            } else {
                const newTicket = {
                    id: tickets.length ? Math.max(...tickets.map(t => t.id)) + 1 : 1,
                    subject: ticketForm.subject.value,
                    client: ticketForm.client.value,
                    priority: ticketForm.priority.value,
                    status: "open",
                    date: new Date().toISOString().split("T")[0],
                    description: ticketForm.description.value,
                };
                tickets.push(newTicket);
            }
            saveTickets();
            ticketModal.classList.add("hidden");
            ticketForm.reset();
            displayTickets();
        });

        searchInput.addEventListener("input", displayTickets);
        statusFilter.addEventListener("change", displayTickets);
        priorityFilter.addEventListener("change", displayTickets);

        displayTickets();
    </script>
</body>
</html>
