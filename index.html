<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sistema de Chamados - SharePoint</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 6px; }
@keyframes highlight { 0% { box-shadow: none } 50% { box-shadow: 0 0 0 6px rgba(59,130,246,0.12) } 100% { box-shadow: none } }
.highlight { animation: highlight 900ms ease; }
.priority-low { border-left: 4px solid #10b981; }
.priority-medium { border-left: 4px solid #f59e0b; }
.priority-high { border-left: 4px solid #ef4444; }
.priority-critical { border-left: 4px solid #7c3aed; }
#exportMenu { min-width: 160px; }

/* Modal de encerrar */
#closeModal .modal-content { background-color: #fef3c7; } /* cor amarela clara */
</style>
</head>
<body class="bg-gray-100 text-gray-800">

<div class="min-h-screen">
<header class="bg-orange-600 text-white shadow">
<div class="container mx-auto px-4 py-4 flex items-center justify-between">
<div>
<h1 class="text-xl font-bold">Sistema de Chamados</h1>
<p class="text-orange-100 text-sm">Gerencie seus atendimentos</p>
</div>
</div>
</header>

<main class="container mx-auto px-4 py-6">
<div class="bg-white rounded shadow overflow-x-auto">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Assunto</th>
<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Técnico</th>
<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Prioridade</th>
<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ações</th>
</tr>
</thead>
<tbody id="ticketsList" class="bg-white divide-y divide-gray-200"></tbody>
</table>
</div>
</main>
</div>

<!-- Modal Encerrar -->
<div id="closeModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
<div class="modal-content bg-yellow-100 rounded-lg w-full max-w-md p-6">
<h3 class="text-lg font-semibold mb-4 text-yellow-800">Encerrar Chamado</h3>
<p id="closeModalText" class="text-yellow-900 mb-4"></p>
<div class="flex justify-end gap-2">
<button onclick="closeCloseModal()" class="bg-gray-300 px-4 py-2 rounded">Cancelar</button>
<button onclick="confirmCloseTicket()" class="bg-yellow-600 text-white px-4 py-2 rounded">Encerrar</button>
</div>
</div>
</div>

<script>
let tickets = [
  {id:1, subject:"Teste", clientName:"Cliente A", clientEmail:"a@a.com", technician:"João", priority:"high", status:"open", date:"27/08/2025"}
];
let closeTicketId = null;

function renderTickets(){
const tbody = document.getElementById("ticketsList");
tbody.innerHTML="";
tickets.forEach(ticket=>{
const tr=document.createElement("tr");
tr.className=`priority-${ticket.priority}`;
tr.innerHTML=`
<td class="px-4 py-3">${ticket.id}</td>
<td class="px-4 py-3 font-medium">${ticket.subject}</td>
<td class="px-4 py-3">${ticket.clientName}<div class="text-xs text-gray-400">${ticket.clientEmail}</div></td>
<td class="px-4 py-3">${ticket.technician}</td>
<td class="px-4 py-3 capitalize">${ticket.priority}</td>
<td class="px-4 py-3 capitalize">${ticket.status.replace("-", " ")}</td>
<td class="px-4 py-3">${ticket.date}</td>
<td class="px-4 py-3 space-x-1">
${ticket.status!=="resolved"?`<button onclick="openCloseModal(${ticket.id})" class="text-green-600 hover:underline">Encerrar</button>`:""}
<button onclick="alert('Visualizar Chamado #${ticket.id}')" class="text-blue-600 hover:underline">Ver</button>
</td>
`;
tbody.appendChild(tr);
});
}

// Modal
function openCloseModal(id){
closeTicketId=id;
const ticket=tickets.find(t=>t.id===id);
document.getElementById("closeModalText").textContent=`Deseja realmente encerrar o chamado #${ticket.id} - ${ticket.subject}?`;
document.getElementById("closeModal").classList.remove("hidden");
}

function closeCloseModal(){
closeTicketId=null;
document.getElementById("closeModal").classList.add("hidden");
}

function confirmCloseTicket(){
if(closeTicketId!==null){
const t=tickets.find(t=>t.id===Number(closeTicketId));
if(t){
t.status="resolved";
const rows=document.querySelectorAll("#ticketsList tr");
rows.forEach(row=>{
if(Number(row.children[0].textContent)===t.id){
row.classList.add("highlight");
}
});
closeCloseModal();
renderTickets();
alert(`Chamado #${t.id} encerrado com sucesso!`);
}
}
}

renderTickets();
</script>

</body>
</html>
