<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Gestão de Chamados</title>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<div class="container mx-auto">

    <!-- Painel Resumo -->
    <div id="painelResumo" class="grid grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-500 text-white p-4 rounded-lg text-center">
            <h3 class="text-lg font-bold">Abertos</h3>
            <p id="countOpen" class="text-2xl font-bold">0</p>
        </div>
        <div class="bg-green-500 text-white p-4 rounded-lg text-center">
            <h3 class="text-lg font-bold">Concluídos</h3>
            <p id="countClosed" class="text-2xl font-bold">0</p>
        </div>
        <div class="bg-orange-500 text-white p-4 rounded-lg text-center">
            <h3 class="text-lg font-bold">Pendentes</h3>
            <p id="countPending" class="text-2xl font-bold">0</p>
        </div>
        <div class="bg-gray-700 text-white p-4 rounded-lg text-center">
            <h3 class="text-lg font-bold">Total</h3>
            <p id="countTotal" class="text-2xl font-bold">0</p>
        </div>
    </div>

    <!-- Cabeçalho -->
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold">Todos os Chamados</h2>
        <div class="flex gap-2">
            <button id="generateReportBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2">
                <i class="fas fa-file-alt"></i><span>Gerar Relatório</span>
            </button>
            <button id="openTicketModal" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-lg flex items-center space-x-2">
                <i class="fas fa-plus"></i><span>Abrir Chamado</span>
            </button>
        </div>
    </div>

    <!-- Tabela -->
    <div class="bg-white shadow-md rounded-lg overflow-hidden">
        <table class="min-w-full text-sm">
            <thead class="bg-gray-100">
                <tr>
                    <th class="py-3 px-4">ID</th>
                    <th class="py-3 px-4">Assunto</th>
                    <th class="py-3 px-4">Cliente</th>
                    <th class="py-3 px-4">Prioridade</th>
                    <th class="py-3 px-4">Status</th>
                    <th class="py-3 px-4">Data</th>
                    <th class="py-3 px-4">Ações</th>
                </tr>
            </thead>
            <tbody id="ticketTableBody"></tbody>
        </table>
    </div>
</div>

<!-- Modal -->
<div id="ticketModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center">
    <div class="bg-white rounded-lg p-6 w-1/2">
        <h2 id="modalTitle" class="text-xl font-bold mb-4">Abrir Chamado</h2>
        <form id="ticketForm" class="space-y-4">
            <input name="subject" placeholder="Assunto" class="w-full border p-2 rounded" required>
            <input name="client" placeholder="Cliente" class="w-full border p-2 rounded" required>
            <select name="priority" class="w-full border p-2 rounded">
                <option value="Baixa">Baixa</option>
                <option value="Média">Média</option>
                <option value="Alta">Alta</option>
            </select>
            <textarea name="description" placeholder="Descrição" class="w-full border p-2 rounded"></textarea>
            <div class="flex justify-end gap-2">
                <button type="button" id="cancelTicketBtn" class="bg-gray-300 px-4 py-2 rounded">Cancelar</button>
                <button type="submit" id="saveTicketBtn" class="bg-orange-600 text-white px-4 py-2 rounded">Salvar</button>
            </div>
        </form>
    </div>
</div>

<script>
let tickets = JSON.parse(localStorage.getItem("tickets")) || [];
let editingTicketId = null;

// Abrir modal novo chamado
document.getElementById("openTicketModal").addEventListener("click", () => {
    editingTicketId = null;
    document.getElementById("modalTitle").textContent = "Abrir Chamado";
    document.getElementById("saveTicketBtn").textContent = "Abrir Chamado";
    document.getElementById("ticketForm").reset();
    document.getElementById("ticketModal").classList.remove("hidden");
});

// Cancelar modal
document.getElementById("cancelTicketBtn").addEventListener("click", () => {
    document.getElementById("ticketModal").classList.add("hidden");
});

// Salvar chamado
document.getElementById("ticketForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const form = e.target;

    if (editingTicketId) {
        let t = tickets.find(t => t.id === editingTicketId);
        t.subject = form.subject.value;
        t.client = form.client.value;
        t.priority = form.priority.value;
        t.description = form.description.value;
    } else {
        tickets.push({
            id: tickets.length ? Math.max(...tickets.map(t => t.id)) + 1 : 1,
            subject: form.subject.value,
            client: form.client.value,
            priority: form.priority.value,
            status: "open",
            date: new Date().toLocaleDateString(),
            description: form.description.value
        });
    }
    localStorage.setItem("tickets", JSON.stringify(tickets));
    displayTickets();
    document.getElementById("ticketModal").classList.add("hidden");
});

// Exibir chamados
function displayTickets() {
    const tbody = document.getElementById("ticketTableBody");
    tbody.innerHTML = "";
    tickets.forEach(ticket => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td class="py-2 px-4">${ticket.id}</td>
            <td class="py-2 px-4">${ticket.subject}</td>
            <td class="py-2 px-4">${ticket.client}</td>
            <td class="py-2 px-4">${ticket.priority}</td>
            <td class="py-2 px-4">${ticket.status}</td>
            <td class="py-2 px-4">${ticket.date}</td>
            <td class="py-2 px-4 space-x-2">
                <button class="editBtn bg-yellow-500 text-white px-2 py-1 rounded">Editar</button>
                <button class="closeBtn bg-green-500 text-white px-2 py-1 rounded">Encerrar</button>
                <button class="deleteBtn bg-red-500 text-white px-2 py-1 rounded">Excluir</button>
            </td>
        `;
        // Editar
        tr.querySelector(".editBtn").addEventListener("click", () => {
            editingTicketId = ticket.id;
            document.getElementById("modalTitle").textContent = "Editar Chamado";
            document.getElementById("saveTicketBtn").textContent = "Salvar Alterações";
            const form = document.getElementById("ticketForm");
            form.subject.value = ticket.subject;
            form.client.value = ticket.client;
            form.priority.value = ticket.priority;
            form.description.value = ticket.description;
            document.getElementById("ticketModal").classList.remove("hidden");
        });
        // Encerrar
        tr.querySelector(".closeBtn").addEventListener("click", () => {
            ticket.status = "closed";
            localStorage.setItem("tickets", JSON.stringify(tickets));
            displayTickets();
        });
        // Excluir
        tr.querySelector(".deleteBtn").addEventListener("click", () => {
            tickets = tickets.filter(t => t.id !== ticket.id);
            localStorage.setItem("tickets", JSON.stringify(tickets));
            displayTickets();
        });
        tbody.appendChild(tr);
    });
    updateResumo();
}

// Atualizar painel resumo
function updateResumo() {
    const total = tickets.length;
    const abertos = tickets.filter(t => t.status === "open").length;
    const concluidos = tickets.filter(t => t.status === "closed").length;
    const pendentes = tickets.filter(t => t.status === "pending").length;
    document.getElementById("countTotal").textContent = total;
    document.getElementById("countOpen").textContent = abertos;
    document.getElementById("countClosed").textContent = concluidos;
    document.getElementById("countPending").textContent = pendentes;
}

// Relatório
document.getElementById("generateReportBtn").addEventListener("click", () => {
    const reportWindow = window.open("", "_blank");
    const now = new Date();
    const dateStr = now.toLocaleDateString() + " " + now.toLocaleTimeString();
    let reportHTML = `
        <html><head><title>Relatório de Chamados</title>
        <style>
            body{font-family:Arial;padding:20px;}
            h1{text-align:center;}
            table{width:100%;border-collapse:collapse;margin-top:20px;}
            th,td{border:1px solid #ccc;padding:8px;text-align:left;}
            th{background:#f4f4f4;}
        </style></head><body>
        <h1>Relatório de Chamados</h1>
        <p>Gerado em: ${dateStr}</p>
        <table><thead><tr>
            <th>ID</th><th>Assunto</th><th>Cliente</th><th>Prioridade</th><th>Status</th><th>Data</th>
        </tr></thead><tbody>
    `;
    tickets.forEach(t => {
        reportHTML += `<tr>
            <td>${t.id}</td><td>${t.subject}</td><td>${t.client}</td>
            <td>${t.priority}</td><td>${t.status}</td><td>${t.date}</td>
        </tr>`;
    });
    const statusCounts = tickets.reduce((acc, t) => {
        acc[t.status] = (acc[t.status] || 0) + 1;
        return acc;
    }, {});
    reportHTML += `</tbody></table><h3>Resumo por Status</h3><ul>`;
    Object.entries(statusCounts).forEach(([st, count]) => {
        reportHTML += `<li>${st}: ${count}</li>`;
    });
    reportHTML += `</ul></body></html>`;
    reportWindow.document.write(reportHTML);
    reportWindow.document.close();
});

displayTickets();
</script>

</body>
</html>
