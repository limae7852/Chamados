<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Chamados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px);} to { opacity: 1; transform: translateY(0);} }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

<!-- Header -->
<header class="bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold text-blue-600"><i class="fa-solid fa-ticket"></i> Sistema de Chamados</h1>
    <div class="flex gap-3">
        <button id="notificationBtn" class="relative p-2 rounded-full bg-blue-50 hover:bg-blue-100 transition">
            <i class="fa-solid fa-bell text-blue-600"></i>
        </button>
        <button id="openCreateModal" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
            <i class="fa-solid fa-plus"></i> Novo Chamado
        </button>
    </div>
</header>

<div class="flex">
    <!-- Sidebar -->
    <aside class="w-60 bg-white shadow-md p-4 space-y-2">
        <button class="w-full text-left px-3 py-2 rounded hover:bg-blue-50"><i class="fa-solid fa-list"></i> Todos</button>
        <button class="w-full text-left px-3 py-2 rounded hover:bg-blue-50"><i class="fa-solid fa-circle text-gray-500"></i> Abertos</button>
        <button class="w-full text-left px-3 py-2 rounded hover:bg-blue-50"><i class="fa-solid fa-spinner text-yellow-500"></i> Em andamento</button>
        <button class="w-full text-left px-3 py-2 rounded hover:bg-blue-50"><i class="fa-solid fa-check text-green-500"></i> Resolvidos</button>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6">
        <table class="min-w-full bg-white shadow rounded-lg overflow-hidden">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Assunto</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Cliente</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Prioridade</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Criado em</th>
                    <th class="px-6 py-3"></th>
                </tr>
            </thead>
            <tbody id="ticketsList" class="divide-y divide-gray-200"></tbody>
        </table>

        <!-- Pagination -->
        <nav class="mt-4 flex justify-center space-x-2" aria-label="Pagination">
            <a href="#" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Anterior</a>
            <a href="#" class="px-3 py-1 bg-blue-500 text-white rounded">1</a>
            <a href="#" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Próximo</a>
        </nav>
    </main>
</div>

<!-- Modal Criar Chamado -->
<div id="createTicketModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg shadow-lg fade-in">
        <h2 class="text-lg font-bold mb-4">Novo Chamado</h2>
        <input id="ticketSubject" type="text" placeholder="Assunto" class="w-full mb-3 p-2 border rounded">
        <input id="ticketClient" type="text" placeholder="Cliente" class="w-full mb-3 p-2 border rounded">
        <select id="ticketPriority" class="w-full mb-3 p-2 border rounded">
            <option value="low">Baixa</option>
            <option value="medium">Média</option>
            <option value="high">Alta</option>
        </select>
        <div class="flex justify-end gap-2">
            <button id="closeCreateModal" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancelar</button>
            <button id="saveTicket" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Salvar</button>
        </div>
    </div>
</div>

<!-- Modal Visualizar Chamado -->
<div id="viewTicketModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-2xl shadow-lg fade-in">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-bold">Chamado <span id="ticketId"></span></h2>
            <button id="closeViewModal"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <p><strong>Assunto:</strong> <span id="ticketSubjectView"></span></p>
        <p><strong>Cliente:</strong> <span id="ticketClientView"></span></p>
        <p><strong>Status:</strong> <span id="ticketStatus"></span></p>
        <div class="mt-3 flex gap-2">
            <button class="px-3 py-1 bg-gray-300 rounded">Aberto</button>
            <button class="px-3 py-1 bg-yellow-300 rounded">Em andamento</button>
            <button class="px-3 py-1 bg-green-300 rounded">Resolvido</button>
        </div>
        <h3 class="mt-4 font-bold">Histórico</h3>
        <div class="space-y-3 max-h-40 overflow-y-auto border p-2 rounded"></div>
        <textarea placeholder="Adicionar comentário" class="w-full p-2 border rounded mt-3"></textarea>
        <button class="mt-2 px-4 py-2 bg-blue-600 text-white rounded">Adicionar Comentário</button>
    </div>
</div>

<script>
/* === Banco de dados (localStorage) === */
const db = {
    getTickets: () => JSON.parse(localStorage.getItem('tickets') || '[]'),
    saveTickets: (tickets) => localStorage.setItem('tickets', JSON.stringify(tickets)),
    addTicket: (ticket) => { const t = db.getTickets(); t.push(ticket); db.saveTickets(t); },
    updateTicketStatus: (id, status) => { let t = db.getTickets(); const idx = t.findIndex(c => c.id === id); if (idx !== -1) { t[idx].status = status; db.saveTickets(t); return true; } return false; }
};

/* === Elementos === */
const ticketsList = document.getElementById('ticketsList');
let currentPage = 1, perPage = 5;

/* === Render Tickets === */
function renderTickets(arr = db.getTickets()) {
    const start = (currentPage - 1) * perPage;
    const paginated = arr.slice(start, start + perPage);
    ticketsList.innerHTML = paginated.length ? paginated.map(t => `
        <tr class="fade-in">
            <td class="px-6 py-4">#${t.id}</td>
            <td class="px-6 py-4"><a href="#" class="view-ticket text-blue-600" data-id="${t.id}">${t.subject}</a></td>
            <td class="px-6 py-4">${t.client}</td>
            <td class="px-6 py-4">${t.priority}</td>
            <td class="px-6 py-4">${t.status}</td>
            <td class="px-6 py-4">${t.createdAt}</td>
            <td class="px-6 py-4"><button class="view-ticket text-blue-600" data-id="${t.id}"><i class="fa-solid fa-eye"></i></button></td>
        </tr>
    `).join('') : `<tr><td colspan="7" class="text-center p-4">Nenhum chamado encontrado</td></tr>`;
    document.querySelectorAll('.view-ticket').forEach(b => b.onclick = e => { e.preventDefault(); viewTicket(+b.dataset.id); });
}

/* === View Ticket === */
function viewTicket(id) {
    const t = db.getTickets().find(c => c.id === id);
    if (!t) return;
    document.getElementById('ticketId').textContent = '#' + t.id;
    document.getElementById('ticketSubjectView').textContent = t.subject;
    document.getElementById('ticketClientView').textContent = t.client;
    document.getElementById('ticketStatus').textContent = t.status;
    document.querySelector('#viewTicketModal .space-y-3').innerHTML = '';
    document.getElementById('viewTicketModal').classList.remove('hidden');
}

/* === Eventos === */
document.getElementById('openCreateModal').onclick = () => document.getElementById('createTicketModal').classList.remove('hidden');
document.getElementById('closeCreateModal').onclick = () => document.getElementById('createTicketModal').classList.add('hidden');
document.getElementById('closeViewModal').onclick = () => document.getElementById('viewTicketModal').classList.add('hidden');
document.getElementById('saveTicket').onclick = () => {
    const subject = document.getElementById('ticketSubject').value;
    const client = document.getElementById('ticketClient').value;
    const priority = document.getElementById('ticketPriority').value;
    if (!subject || !client) return alert('Preencha todos os campos');
    db.addTicket({ id: Date.now(), subject, client, priority, status: 'open', createdAt: new Date().toLocaleString() });
    document.getElementById('createTicketModal').classList.add('hidden');
    renderTickets();
};

/* === Inicializa === */
renderTickets();
</script>

</body>
</html>
