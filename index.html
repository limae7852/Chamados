<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Abertura de Chamados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .priority-low {
            border-left: 4px solid #10B981;
        }
        
        .priority-medium {
            border-left: 4px solid #F59E0B;
        }
        
        .priority-high {
            border-left: 4px solid #EF4444;
        }
        
        .ticket-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Sistema de Chamados</h1>
                <p class="text-gray-600">Gerencie e acompanhe seus tickets</p>
            </div>
            <button id="newTicketBtn" class="bg-orange-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg flex items-center transition">
                <i class="fas fa-plus mr-2"></i> Novo Chamado
            </button>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Ticket Form (Hidden by default) -->
            <div id="ticketFormContainer" class="lg:col-span-3 hidden">
                <div class="bg-white rounded-lg shadow-md p-6 fade-in">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Abrir Novo Chamado</h2>
                    <form id="ticketForm" class="space-y-4">
                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Título</label>
                            <input type="text" id="title" name="title" required 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Descrição</label>
                            <textarea id="description" name="description" rows="4" required
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="requesterEmail" class="block text-sm font-medium text-gray-700 mb-1">Seu E-mail</label>
                                <input type="email" id="requesterEmail" name="requesterEmail" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                <select id="category" name="category" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Selecione...</option>
                                    <option value="Software">Prof. Paschoal</option>
                                    <option value="Software">Software</option>
                                    <option value="Hardware">Hardware</option>
                                    <option value="Rede">Rede</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="priority" class="block text-sm font-medium text-gray-700 mb-1">Prioridade</label>
                                <select id="priority" name="priority" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Selecione...</option>
                                    <option value="Baixa">Baixa</option>
                                    <option value="Média">Média</option>
                                    <option value="Alta">Alta</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-2">
                            <button type="button" id="cancelTicketBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">
                                Cancelar
                            </button>
                            <button type="submit" class="bg-orange-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition">
                                Enviar Chamado
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Ticket List -->
            <div class="lg:col-span-2 space-y-4">
                <div class="bg-white rounded-lg shadow-md p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Meus Chamados</h2>
                        <div class="relative">
                            <select id="filterStatus" class="appearance-none bg-gray-100 border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">Todos</option>
                                <option value="open">Abertos</option>
                                <option value="in-progress">Em Progresso</option>
                                <option value="closed">Resolvidos</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div id="ticketList" class="space-y-3">
                        <!-- Tickets will be added here dynamically -->
                        <div class="text-center py-8 text-gray-500" id="emptyState">
                            <i class="fas fa-ticket-alt text-4xl mb-3 opacity-30"></i>
                            <p>Nenhum chamado encontrado</p>
                            <button id="createFirstTicket" class="mt-4 text-blue-600 hover:text-blue-800 font-medium">
                                Criar seu primeiro chamado
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stats and Info -->
            <div class="space-y-4">
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Estatísticas</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                            <div>
                                <p class="text-sm text-gray-600">Abertos</p>
                                <p class="text-2xl font-bold" id="openCount">0</p>
                            </div>
                            <div class="p-3 rounded-full bg-green-100 text-green-600">
                                <i class="fas fa-folder-open"></i>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                            <div>
                                <p class="text-sm text-gray-600">Em Progresso</p>
                                <p class="text-2xl font-bold" id="progressCount">0</p>
                            </div>
                            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                <i class="fas fa-spinner"></i>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                            <div>
                                <p class="text-sm text-gray-600">Resolvidos</p>
                                <p class="text-2xl font-bold" id="closedCount">0</p>
                            </div>
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h2 class="text-xl font-semibold text-gray-800 mb-3">Informações</h2>
                    <div class="space-y-2 text-sm text-gray-600">
                        <p><i class="fas fa-info-circle mr-2 text-gray-500"></i> Chamados são atendidos em até 48h</p>
                        <p><i class="fas fa-clock mr-2 text-gray-500"></i> Prioridade alta tem resposta em até 4h</p>
                        <p><i class="fas fa-envelope mr-2 text-gray-500"></i> Você receberá atualizações por e-mail</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ticket Details Modal -->
    <div id="ticketModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto fade-in">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 id="modalTitle" class="text-2xl font-bold text-gray-800"></h2>
                        <div class="flex items-center mt-1 space-x-2">
                            <span id="modalStatus" class="px-2 py-1 rounded-full text-xs font-medium"></span>
                            <span id="modalPriority" class="px-2 py-1 rounded-full text-xs font-medium"></span>
                            <span id="modalCategory" class="text-sm text-gray-600"></span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="editTicketBtn" class="text-blue-600 hover:text-blue-800" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button id="closeTicketBtn" class="text-green-600 hover:text-green-800" title="Encerrar">
                            <i class="fas fa-check-circle"></i>
                        </button>
                        <button id="deleteTicketBtn" class="text-red-600 hover:text-red-800" title="Excluir">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700" title="Fechar">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">Descrição</h3>
                    <p id="modalDescription" class="text-gray-600 bg-gray-50 p-3 rounded-lg"></p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <h3 class="font-medium text-gray-700 mb-2">Aberto por</h3>
                        <p id="modalAuthor" class="text-gray-600">Você</p>
                    </div>
                    <div>
                        <h3 class="font-medium text-gray-700 mb-2">Data de abertura</h3>
                        <p id="modalDate" class="text-gray-600"></p>
                    </div>
                </div>
                
                <div id="commentsSection">
                    <h3 class="font-medium text-gray-700 mb-3">Atualizações</h3>
                    <div id="commentsList" class="space-y-3 mb-4">
                        <!-- Comments will be added here -->
                    </div>
                    
                    <div class="border-t pt-4">
                        <form id="addCommentForm" class="flex space-x-2">
                            <input type="text" id="newComment" placeholder="Adicionar comentário..." required
                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data - in a real app, this would come from a database
        let tickets = [];
        const SUPPORT_EMAIL = 'suporte@empresa.com'; // Would be configured in a real app
        
        // DOM Elements
        const ticketFormContainer = document.getElementById('ticketFormContainer');
        const newTicketBtn = document.getElementById('newTicketBtn');
        const cancelTicketBtn = document.getElementById('cancelTicketBtn');
        const ticketForm = document.getElementById('ticketForm');
        const ticketList = document.getElementById('ticketList');
        const emptyState = document.getElementById('emptyState');
        const createFirstTicket = document.getElementById('createFirstTicket');
        const filterStatus = document.getElementById('filterStatus');
        const ticketModal = document.getElementById('ticketModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const addCommentForm = document.getElementById('addCommentForm');
        
        // Stats elements
        const openCountEl = document.getElementById('openCount');
        const progressCountEl = document.getElementById('progressCount');
        const closedCountEl = document.getElementById('closedCount');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Load any saved tickets from localStorage
            const savedTickets = localStorage.getItem('tickets');
            if (savedTickets) {
                tickets = JSON.parse(savedTickets);
                updateTicketList();
                updateStats();
            }
            
            // Event listeners
            newTicketBtn.addEventListener('click', showTicketForm);
            cancelTicketBtn.addEventListener('click', hideTicketForm);
            createFirstTicket.addEventListener('click', showTicketForm);
            ticketForm.addEventListener('submit', handleTicketSubmit);
            filterStatus.addEventListener('change', updateTicketList);
            closeModalBtn.addEventListener('click', () => ticketModal.classList.add('hidden'));
            addCommentForm.addEventListener('submit', addComment);
        });
        
        function showTicketForm() {
            ticketFormContainer.classList.remove('hidden');
            ticketFormContainer.scrollIntoView({ behavior: 'smooth' });
            emptyState.classList.add('hidden');
        }
        
        function hideTicketForm() {
            ticketFormContainer.classList.add('hidden');
            ticketForm.reset();
        }
        
        // Email notification function
        function sendEmailNotification(to, subject, body) {
            // In a real app, this would connect to an email service
            console.log(`Email sent to: ${to}`);
            console.log(`Subject: ${subject}`);
            console.log(`Body: ${body}`);
            
            // For demo purposes, we'll just show an alert
            alert(`Notificação enviada para: ${to}\n\nAssunto: ${subject}\n\nMensagem: ${body}`);
        }

        function handleTicketSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(ticketForm);
            const requesterEmail = formData.get('requesterEmail');
            const newTicket = {
                requesterEmail: requesterEmail,
                id: Date.now().toString(),
                title: formData.get('title'),
                description: formData.get('description'),
                category: formData.get('category'),
                priority: formData.get('priority'),
                status: 'open',
                date: new Date().toLocaleString('pt-BR'),
                comments: []
            };
            
            tickets.unshift(newTicket);
            saveTickets();
            updateTicketList();
            updateStats();
            hideTicketForm();
            
            // Show success message
            // Send notification to requester
            sendEmailNotification(
                requesterEmail,
                `Chamado criado: ${newTicket.title}`,
                `Seu chamado foi criado com sucesso!\n\nID: ${newTicket.id}\nTítulo: ${newTicket.title}\nStatus: Aberto\n\nAcompanhe pelo sistema.`
            );
            
            // In a real app, you would also send to support team
            sendEmailNotification(
                'suporte@empresa.com',
                `Novo chamado: ${newTicket.title}`,
                `Novo chamado criado:\n\nID: ${newTicket.id}\nTítulo: ${newTicket.title}\nPrioridade: ${newTicket.priority}\n\nPor favor, atenda o mais breve possível.`
            );
        }
        
        function updateTicketList() {
            const filterValue = filterStatus.value;
            let filteredTickets = [...tickets];
            
            if (filterValue !== 'all') {
                filteredTickets = tickets.filter(ticket => {
                    if (filterValue === 'open') return ticket.status === 'open';
                    if (filterValue === 'in-progress') return ticket.status === 'in-progress';
                    if (filterValue === 'closed') return ticket.status === 'closed';
                    return true;
                });
            }
            
            if (filteredTickets.length === 0) {
                ticketList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-search text-4xl mb-3 opacity-30"></i>
                        <p>Nenhum chamado encontrado</p>
                    </div>
                `;
                return;
            }
            
            ticketList.innerHTML = '';
            
            filteredTickets.forEach(ticket => {
                const priorityClass = getPriorityClass(ticket.priority);
                const statusClass = getStatusClass(ticket.status);
                const statusText = getStatusText(ticket.status);
                
                const ticketEl = document.createElement('div');
                ticketEl.className = `ticket-card bg-white border border-gray-200 rounded-lg p-4 cursor-pointer transition ${priorityClass}`;
                ticketEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium text-gray-800">${ticket.title}</h3>
                            <p class="text-sm text-gray-500 truncate mt-1">${ticket.description.substring(0, 60)}...</p>
                        </div>
                        <span class="${statusClass} px-2 py-1 rounded-full text-xs font-medium">${statusText}</span>
                    </div>
                    <div class="flex justify-between items-center mt-3 text-sm">
                        <span class="text-gray-500">${ticket.category}</span>
                        <span class="text-gray-500">${ticket.date}</span>
                    </div>
                `;
                
                ticketEl.addEventListener('click', () => openTicketDetails(ticket.id));
                ticketList.appendChild(ticketEl);
            });
        }
        
        function openTicketDetails(ticketId) {
            const ticket = tickets.find(t => t.id === ticketId);
            if (!ticket) return;
            
            // Update modal content
            document.getElementById('modalTitle').textContent = ticket.title;
            document.getElementById('modalDescription').textContent = ticket.description;
            document.getElementById('modalCategory').textContent = ticket.category;
            document.getElementById('modalDate').textContent = ticket.date;
            
            // Update status and priority badges
            const statusClass = getStatusClass(ticket.status);
            const statusText = getStatusText(ticket.status);
            const priorityClass = getPriorityClass(ticket.priority, true);
            
            document.getElementById('modalStatus').className = `${statusClass} px-2 py-1 rounded-full text-xs font-medium`;
            document.getElementById('modalStatus').textContent = statusText;
            
            document.getElementById('modalPriority').className = `${priorityClass} px-2 py-1 rounded-full text-xs font-medium`;
            document.getElementById('modalPriority').textContent = ticket.priority;
            
            // Update comments
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = '';
            
            if (ticket.comments.length === 0) {
                commentsList.innerHTML = '<p class="text-gray-500 text-sm">Nenhuma atualização ainda</p>';
            } else {
                ticket.comments.forEach(comment => {
                    const commentEl = document.createElement('div');
                    commentEl.className = 'bg-gray-50 p-3 rounded-lg';
                    commentEl.innerHTML = `
                        <div class="flex justify-between items-start mb-1">
                            <span class="text-sm font-medium">Suporte</span>
                            <span class="text-xs text-gray-500">${comment.date}</span>
                        </div>
                        <p class="text-sm text-gray-600">${comment.text}</p>
                    `;
                    commentsList.appendChild(commentEl);
                });
            }
            
            // Show modal
            ticketModal.classList.remove('hidden');
        }
        
        function addComment(e) {
            e.preventDefault();
            const commentInput = document.getElementById('newComment');
            const commentText = commentInput.value.trim();
            
            if (!commentText) return;
            
            // Find the ticket being viewed
            const modalTitle = document.getElementById('modalTitle').textContent;
            const ticket = tickets.find(t => t.title === modalTitle);
            
            if (ticket) {
                const newComment = {
                    text: commentText,
                    date: new Date().toLocaleString('pt-BR'),
                    author: 'user'
                };
                
                ticket.comments.unshift(newComment);
                saveTickets();
                openTicketDetails(ticket.id);
                commentInput.value = '';
            }
        }
        
        function updateStats() {
            const openCount = tickets.filter(t => t.status === 'open').length;
            const progressCount = tickets.filter(t => t.status === 'in-progress').length;
            const closedCount = tickets.filter(t => t.status === 'closed').length;
            
            openCountEl.textContent = openCount;
            progressCountEl.textContent = progressCount;
            closedCountEl.textContent = closedCount;
        }
        
        function saveTickets() {
            localStorage.setItem('tickets', JSON.stringify(tickets));
        }
        
        // Helper functions
        function getPriorityClass(priority, isBadge = false) {
            if (isBadge) {
                if (priority === 'Baixa') return 'bg-green-100 text-green-800';
                if (priority === 'Média') return 'bg-yellow-100 text-yellow-800';
                if (priority === 'Alta') return 'bg-red-100 text-red-800';
            } else {
                if (priority === 'Baixa') return 'priority-low';
                if (priority === 'Média') return 'priority-medium';
                if (priority === 'Alta') return 'priority-high';
            }
            return '';
        }
        
        function getStatusClass(status) {
            if (status === 'open') return 'bg-blue-100 text-blue-800';
            if (status === 'in-progress') return 'bg-purple-100 text-purple-800';
            if (status === 'closed') return 'bg-green-100 text-green-800';
            return '';
        }
        
        function getStatusText(status) {
            if (status === 'open') return 'Aberto';
            if (status === 'in-progress') return 'Em Progresso';
            if (status === 'closed') return 'Resolvido';
            return '';
        }

        // Ticket Actions
        const editTicketBtn = document.getElementById('editTicketBtn');
        const closeTicketBtn = document.getElementById('closeTicketBtn');
        const deleteTicketBtn = document.getElementById('deleteTicketBtn');
        
        // Event listeners for new buttons
        closeTicketBtn.addEventListener('click', closeTicket);
        deleteTicketBtn.addEventListener('click', deleteTicket);
        const editTicketModal = document.getElementById('editTicketModal');
        const closeEditModalBtn = document.getElementById('closeEditModalBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const editTicketForm = document.getElementById('editTicketForm');
        
        editTicketBtn.addEventListener('click', openEditTicketForm);
        closeEditModalBtn.addEventListener('click', () => editTicketModal.classList.add('hidden'));
        cancelEditBtn.addEventListener('click', () => editTicketModal.classList.add('hidden'));
        editTicketForm.addEventListener('submit', handleTicketEdit);
        
        function openEditTicketForm() {
            const modalTitle = document.getElementById('modalTitle').textContent;
            const ticket = tickets.find(t => t.title === modalTitle);
            
            if (ticket) {
                // Fill the form with ticket data
                document.getElementById('editTicketId').value = ticket.id;
                document.getElementById('editTitle').value = ticket.title;
                document.getElementById('editDescription').value = ticket.description;
                document.getElementById('editCategory').value = ticket.category;
                document.getElementById('editPriority').value = ticket.priority;
                document.getElementById('editStatus').value = ticket.status;
                
                // Show edit modal
                ticketModal.classList.add('hidden');
                editTicketModal.classList.remove('hidden');
            }
        }
        
        function closeTicket() {
            const modalTitle = document.getElementById('modalTitle').textContent;
            const ticket = tickets.find(t => t.title === modalTitle);
            
            if (ticket && confirm('Deseja realmente encerrar este chamado?')) {
                ticket.status = 'closed';
                ticket.comments.unshift({
                    text: 'Chamado encerrado pelo usuário',
                    date: new Date().toLocaleString('pt-BR'),
                    author: 'system'
                });
                saveTickets();
                updateTicketList();
                updateStats();
                ticketModal.classList.add('hidden');
                // Send notification to requester
                sendEmailNotification(
                    ticket.requesterEmail,
                    `Chamado encerrado: ${ticket.title}`,
                    `Seu chamado foi encerrado:\n\nID: ${ticket.id}\nTítulo: ${ticket.title}\nStatus: Resolvido\n\nObrigado por utilizar nosso sistema.`
                );
            }
        }
        
        function deleteTicket() {
            const modalTitle = document.getElementById('modalTitle').textContent;
            const ticketIndex = tickets.findIndex(t => t.title === modalTitle);
            
            if (ticketIndex !== -1 && confirm('Deseja realmente excluir este chamado? Esta ação não pode ser desfeita.')) {
                tickets.splice(ticketIndex, 1);
                saveTickets();
                updateTicketList();
                updateStats();
                ticketModal.classList.add('hidden');
                alert('Chamado excluído com sucesso!');
            }
        }
        
        function handleTicketEdit(e) {
            e.preventDefault();
            
            const ticketId = document.getElementById('editTicketId').value;
            const ticketIndex = tickets.findIndex(t => t.id === ticketId);
            
            if (ticketIndex !== -1) {
                tickets[ticketIndex] = {
                    ...tickets[ticketIndex],
                    title: document.getElementById('editTitle').value,
                    description: document.getElementById('editDescription').value,
                    category: document.getElementById('editCategory').value,
                    priority: document.getElementById('editPriority').value,
                    status: document.getElementById('editStatus').value
                };
                
                saveTickets();
                updateTicketList();
                updateStats();
                editTicketModal.classList.add('hidden');
                
                // Reopen the details modal with updated info
                openTicketDetails(ticketId);
                
                // Send notification to requester if status changed
                if (document.getElementById('editStatus').value !== tickets[ticketIndex].status) {
                    sendEmailNotification(
                        tickets[ticketIndex].requesterEmail,
                        `Atualização no chamado: ${tickets[ticketIndex].title}`,
                        `Seu chamado foi atualizado:\n\nID: ${tickets[ticketIndex].id}\nNovo status: ${getStatusText(document.getElementById('editStatus').value)}\n\nAcompanhe pelo sistema.`
                    );
                }
            }
        }
    </script>

    <!-- Edit Ticket Modal -->
    <div id="editTicketModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto fade-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Editar Chamado</h2>
                    <button id="closeEditModalBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="editTicketForm" class="space-y-4">
                    <input type="hidden" id="editTicketId">
                    
                    <div>
                        <label for="editTitle" class="block text-sm font-medium text-gray-700 mb-1">Título</label>
                        <input type="text" id="editTitle" name="title" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label for="editDescription" class="block text-sm font-medium text-gray-700 mb-1">Descrição</label>
                        <textarea id="editDescription" name="description" rows="4" required
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="editRequesterEmail" class="block text-sm font-medium text-gray-700 mb-1">E-mail do Solicitante</label>
                            <input type="email" id="editRequesterEmail" name="requesterEmail" required
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="editCategory" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                            <select id="editCategory" name="category" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Selecione...</option>
                                <option value="Software">Prof. Paschoal</option>
                                <option value="Software">Software</option>
                                <option value="Hardware">Hardware</option>
                                <option value="Rede">Rede</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="editPriority" class="block text-sm font-medium text-gray-700 mb-1">Prioridade</label>
                            <select id="editPriority" name="priority" required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Selecione...</option>
                                <option value="Baixa">Baixa</option>
                                <option value="Média">Média</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="editStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select id="editStatus" name="status" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="open">Aberto</option>
                            <option value="in-progress">Em Progresso</option>
                            <option value="closed">Resolvido</option>
                        </select>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-2">
                        <button type="button" id="cancelEditBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition">
                            Salvar Alterações
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>
